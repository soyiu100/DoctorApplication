<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${param.admin} ? 'Admin Login' : (${param.doctor} ? 'Doctor Login' : 'Patient Login')"></title>
    <th:block th:include="../fragments/header.html"></th:block>
</head>
<body>
<div layout:fragment="content" th:remove="tag">

    <th:block th:include="../fragments/navbar.html"></th:block>
    <div class="row" style="padding-top: 2%;">
        <div class="col-lg-6 offset-md-3">
            <div id="error-message">
                <!-- Attribute/param 'error' is passed here -->
                <div class="alert alert-danger" th:if="${error}">Invalid username or password.</div>
                <!-- Flash attribute 'user_name_val' is passed here -->
                <div class="alert alert-info" th:if="${user_name_val}"
                     th:text="${'Registration success! Your user name is ' + user_name_val +
                        '. Please check your email for your temporary password.'}">
                </div>
                <div class="alert alert-info" th:if="${passwordChanged}">
                    Your password was changed successfully. Please log in again.
                </div>
                <div th:if="${param.error}">
                    <div class="alert alert-danger">
                        Invalid username or password.
                    </div>
                </div>
                <div th:if="${param.logout}">
                    <div class="alert alert-info">
                        You have been logged out.
                    </div>
                </div>
            </div>
            <h1>Login page</h1>
            <hr/>

            <h3 class="float-right" th:text="${param.admin} ? 'Admin Login' : (${param.doctor} ? 'Doctor Login' : 'Patient Login')"></h3>
            <br/>

            <form id="login-form" action="login.do" method="post" style="padding-top: 3%;">
                <div class="form-group">
                    <label for="username">Username</label>:
                    <input type="text" id="username" class="form-control" name="username" placeholder="Username"/>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>:
                    <input type="password" id="password" class="form-control" name="password" placeholder="Password"/>
                </div>
                <div class="d-block">
                        <input type="hidden" id="userType" class="form-control"
                               name="userType" th:value="${param.admin} ? 'admin' : (${param.doctor} ? 'doctor' : 'patient')" required>
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <input type="submit"
                               name="login-submit"
                               id="login-submit"
                               class="btn btn-info"
                               value="Log In">

                        <div class="float-right"><a th:href="${param.admin} ? '/admin/register' : (${param.doctor} ? '/register' : '/patient/register')" class="btn btn btn-outline-info">Register New User</a></div>
                </div>
                <div class="d-flex justify-content-center" style="padding-top: 3%;">
                    <div style="font-size: 0.9rem; padding-right: 50px;">
                        <span th:text="${param.admin} ? 'Not an admin? Log in as a patient '
                            : (${param.doctor} ? 'Not a doctor? Log in as a patient ' : 'Not a patient? Log in as a doctor ')">
                        </span><a th:href="${param.admin} ? '/login' : (${param.doctor} ? '/login' : '/doctor/login')">here</a>
                    </div>
                </div>
                <div class="d-flex justify-content-center">
                    <div style="font-size: 0.9rem; padding-right: 50px;">
                            <span th:text="${param.admin} ? 'Log in as a doctor '
                                : (${param.doctor} ? 'Log in as an admin ' : 'Log in as an admin ')">
                            </span><a th:href="${param.admin} ? '/doctor/login' : (${param.doctor} ? '/admin/login' : '/admin/login')">here</a>
                    </div>
                </div>

            </form>
        </div>
    </div>
</div>
</body>
<th:block th:include="../fragments/remove_logout.html"></th:block>

<script>
    $("#login-form").submit(function(event) {
        $(".form-group").each(function() {
            if ($(this).find('input').val().trim() == '') {
                if ($("#error-message").has("div")) {
                    $("#error-message").empty();
                }
                $("#error-message").append("<div id='no-input' " +
                    "class='alert alert-warning'>Please input both a username and password.</div>");
                event.preventDefault();
            }
        });
    });
</script>
</html>